#!/bin/bash
# This file prepares your host computer for running the Foodcoop development
# container.

# Sanity tests
if ! which npm &>/dev/null; then
  printf "Please install npm.\n"
  exit 1
fi

if ! which git &>/dev/null; then
  printf "Please install git.\n"
  exit 1
fi

cwd=$(pwd)

printf "Checking out software.\n"

# Wordpress
mkdir -p "${cwd}/foodcoop"
cd "${cwd}/foodcoop"
git clone --recursive git@github.com:foodcoop/foodcoop-test.git wordpress/foodcoop-test

# API
git clone git@github.com:foodcoop/foodcoop-api.git api
cd api
npm install

printf "Downloading config files.\n"

# Config files.
cd "${cwd}/foodcoop/wordpress/foodcoop-test/"
wget https://raw.githubusercontent.com/foodcoop/docker-development/master/wp-config.php
cd "${cwd}/foodcoop/api/"
https://raw.githubusercontent.com/foodcoop/docker-development/master/config.json

printf "Launching Docker image.\n"

docker run -d --name foodcoopdev \
  -v "$(pwd)/foodcoop:/var/www/foodcoop" \
  -p 127.0.0.1:3456:3456 \
  -p 127.0.0.1:6789:80 \
  jamiemcclelland/foodcoopdev:latest runsvdir

printf "Almost done! Now, login to your container and import the default data\n"
printf "docker exec -it foodcoopdev\n"
printf "/root/import-data\n"
printf "exit"


